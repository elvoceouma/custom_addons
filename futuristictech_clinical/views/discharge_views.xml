<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_hospital_discharge_form" model="ir.ui.view">
        <field name="name">hospital.discharge.form</field>
        <field name="model">hospital.discharge</field>
        <field name="arch" type="xml">
            <form string="Discharge">
                <header>
                    <button name="action_confirm" string="Confirm" type="object" class="oe_highlight" groups="base.group_user" 
                            invisible="state != 'draft'"/>
                    <button name="action_approve" string="Approve" type="object" class="oe_highlight" groups="medicine_register.group_approve_discharge" 
                            invisible="state != 'waiting_for_approval'"/>
                    <button name="action_close" string="Close" type="object" class="oe_highlight" groups="medicine_register.group_close_discharge" 
                            invisible="state != 'approve'"/>
                    <button name="action_cancel" string="Cancel" type="object" class="oe_highlight" groups="medicine_register.group_approve_discharge" 
                            invisible="state not in ('draft', 'waiting_for_approval')"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,waiting_for_approval,approve,close,cancel"/>
                </header>
                <sheet>
                    <div class="oe_right oe_button_box" style="width: 500px;" name="buttons">
                        <button type="object" class="oe_stat_button" string="Medicine Packing" name="action_medicine_packing" 
                                context="{'search_default_discharge_id': active_id,'default_discharge_id': active_id}" 
                                icon="fa-list" groups="medicine_register.group_discharge_nurses"
                                invisible="state != 'approve'">
                        </button>
                        <button type="object" class="oe_stat_button" string="Requisition Clearance" name="action_requisition_clearance" 
                                context="{'search_default_discharge_id': active_id,'default_discharge_id': active_id}" 
                                icon="fa-list" groups="medicine_register.group_discharge_counsellors"
                                invisible="state != 'approve'">
                        </button>
                        <button type="object" class="oe_stat_button" string="Store Clearance" name="action_store_clearance" 
                                context="{'search_default_discharge_id': active_id,'default_discharge_id': active_id}" 
                                icon="fa-list" groups="medicine_register.group_discharge_stores"
                                invisible="state != 'approve'">
                        </button>
                        <button type="object" class="oe_stat_button" string="Discharge Summary" name="action_discharge_summary" 
                                context="{'search_default_inpatient_admission_id': inpatient_admission_id,'default_inpatient_admission_id': inpatient_admission_id,'default_patient_id': patient_id,'default_campus': campus}" 
                                icon="fa-list" groups="medicine_register.group_discharge_counsellors"
                                invisible="state != 'approve'">
                        </button>
                    </div>

                    <div class="oe_left" style="width: 500px;">
                        <div class="oe_title">
                            <label for="name" string="Discharge #" class="o_form_label"/>
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                    </div>
                    <group>
                        <group>
                            <field name="inpatient_admission_id" domain="[('state', '!=', 'Discharged')]" 
                                   readonly="state != 'draft'"/>
                            <field name="patient_id" readonly="state != 'draft'"/>
                            <field name="requested_by" readonly="state not in ('draft','waiting_for_approval')" 
                                   required="state == 'waiting_for_approval'" options="{&quot;no_create&quot;: True}"/>
                        </group>
                        <group>
                            <field name="discharge_date"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Other Details">
                            <group>
                                <group>
                                    <field name="approved_by"/>    
                                    <field name="approved_date"/>
                                </group>
                                <group>
                                    <field name="campus"/>    
                                    <field name="company_id"/>    
                                    <field name="prescription_id"/>
                                </group>
                            </group>

                            <group string="Clearance Details">
                                <group>
                                    <field name="counsellor"/>    
                                    <field name="nurse"/>
                                    <field name="store_incharge"/>
                                </group>
                                <group>
                                </group>
                            </group>
                            <field name="description" readonly="state != 'draft'" placeholder="Description..."/>    
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="view_hospital_discharge_summary_form" model="ir.ui.view">
        <field name="name">hospital.discharge.summary.form</field>
        <field name="model">hospital.discharge.summary</field>
        <field name="arch" type="xml">
            <form string="Discharge Summary">
                <header>
                    <button name="action_confirm" string="Confirm" type="object" class="oe_highlight" 
                            invisible="state != 'draft'"/>
                    <button name="action_approve_clinical_psychologist" string="Approve" type="object" class="oe_highlight" 
                            groups="medicine_register.group_discharge_psychologist" 
                            invisible="clinical_psychologist_bool or state != 'inprogress'"/>
                    <button name="action_approve_psychiatrist" string="Approve" type="object" class="oe_highlight" 
                            groups="medicine_register.group_discharge_psychiatrist" 
                            invisible="psychiatrist_bool or state != 'inprogress'"/>
                    <button name="action_approve_registrar" string="Approve" type="object" class="oe_highlight" 
                            groups="medicine_register.group_discharge_registrar" 
                            invisible="registrar_bool or state != 'inprogress'"/>
                    <field name="state" statusbar_visible="draft,inprogress,approve" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_left" style="width: 500px;">
                        <div class="oe_title">
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                    </div>
                    <group>
                        <group>
                            <field name="inpatient_admission_id"/>
                            <field name="patient_id"/>
                            <field name="campus"/>
                            <field name="company_id"/>
                        </group>
                        <group>
                            <field name="clinical_psychologist"/>
                            <field name="psychiatrist"/>
                            <field name="registrar"/>
                            <field name="clinical_psychologist_bool" invisible="1"/>
                            <field name="psychiatrist_bool" invisible="1"/>
                            <field name="registrar_bool" invisible="1"/>
                        </group>
                    </group>
                    <field name="description" placeholder="Description..."/>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>
</odoo>