<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Registration Form Form View -->
    <record id="view_hospital_registration_form" model="ir.ui.view">
        <field name="name">hospital.registration.form.form</field>
        <field name="model">hospital.registration.form</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_register" string="Register" type="object" class="oe_highlight" 
                            invisible="state != 'draft'"/>
                    <button name="action_cancel" string="Cancel" type="object" 
                            invisible="state not in ('draft', 'registered')"/>
                    <button name="action_draft" string="Set to Draft" type="object" 
                            invisible="state != 'cancelled'"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,registered,admitted,cancelled"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="reference" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="date"/>
                            <field name="registration_type" widget="radio"/>
                            <field name="campus_id" options="{'no_create': True}"/>
                        </group>
                        <group>
                            <field name="patient_id" options="{'no_create_edit': False}"/>
                            <field name="physician_id" options="{'no_create': True}"/>
                            <field name="referral_source"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Patient Information" name="patient_info">
                            <group>
                                <group>
                                    <field name="name" readonly="patient_id"/>
                                    <field name="gender"/>
                                    <field name="age"/>
                                    <field name="dob"/>
                                </group>
                                <group>
                                    <field name="blood_group"/>
                                    <field name="mobile"/>
                                    <field name="email"/>
                                    <field name="address"/>
                                </group>
                            </group>
                            <group string="Medical Information">
                                <field name="illness_tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                                <field name="allergies" placeholder="List any allergies..."/>
                                <field name="current_medications" placeholder="List current medications..."/>
                                <field name="pre_existing_conditions" placeholder="List pre-existing conditions..."/>
                                <field name="family_history" placeholder="Family medical history..."/>
                            </group>
                        </page>
                        
                        <page string="Emergency Contact" name="emergency_contact">
                            <group>
                                <field name="emergency_contact"/>
                                <field name="emergency_relation"/>
                                <field name="emergency_phone"/>
                            </group>
                        </page>
                        
                        <page string="Insurance" name="insurance">
                            <group>
                                <field name="insurance_provider"/>
                                <field name="policy_number"/>
                                <field name="policy_holder"/>
                            </group>
                        </page>
                        
                        <page string="Admission" name="admission" invisible="registration_type != 'ip'">
                            <group>
                                <field name="is_admission_needed"/>
                            </group>
                            <group invisible="not is_admission_needed">
                                <group>
                                    <field name="admission_date"/>
                                    <field name="block_id" domain="[('hospital_id', '=', campus_id)]" options="{'no_create': True}" 
                                           required="is_admission_needed"/>
                                    <field name="room_id" domain="[('block_id', '=', block_id)]" options="{'no_create': True}" 
                                           required="is_admission_needed"/>
                                </group>
                                <group>
                                    <field name="bed_id" domain="[('room_id', '=', room_id), ('status', '=', 'free')]" options="{'no_create': True}" 
                                           required="is_admission_needed"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Documents" name="documents">
                            <group>
                                <field name="attachment_ids" widget="many2many_binary"/>
                                <field name="consent_signed"/>
                            </group>
                        </page>
                        
                        <page string="Notes" name="notes">
                            <field name="notes" placeholder="Additional notes or comments..."/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>
    
    <!-- Registration Form Tree View -->
    <record id="view_hospital_registration_form_tree" model="ir.ui.view">
        <field name="name">hospital.registration.form.tree</field>
        <field name="model">hospital.registration.form</field>
        <field name="arch" type="xml">
            <tree decoration-info="state == 'draft'" decoration-success="state == 'registered'" 
                  decoration-primary="state == 'admitted'" decoration-danger="state == 'cancelled'">
                <field name="reference"/>
                <field name="date"/>
                <field name="name"/>
                <field name="registration_type"/>
                <field name="campus_id"/>
                <field name="physician_id"/>
                <field name="state"/>
            </tree>
        </field>
    </record>
    
    <!-- Registration Form Search View -->
    <record id="view_hospital_registration_form_search" model="ir.ui.view">
        <field name="name">hospital.registration.form.search</field>
        <field name="model">hospital.registration.form</field>
        <field name="arch" type="xml">
            <search>
                <field name="reference"/>
                <field name="name"/>
                <field name="patient_id"/>
                <field name="campus_id"/>
                <field name="physician_id"/>
                <separator/>
                <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Registered" name="registered" domain="[('state', '=', 'registered')]"/>
                <filter string="Admitted" name="admitted" domain="[('state', '=', 'admitted')]"/>
                <filter string="Cancelled" name="cancelled" domain="[('state', '=', 'cancelled')]"/>
                <separator/>
                <filter string="Outpatient" name="op" domain="[('registration_type', '=', 'op')]"/>
                <filter string="Inpatient" name="ip" domain="[('registration_type', '=', 'ip')]"/>
                <filter string="Emergency" name="emergency" domain="[('registration_type', '=', 'emergency')]"/>
                <group expand="0" string="Group By">
                    <filter string="Status" name="group_by_state" context="{'group_by': 'state'}"/>
                    <filter string="Registration Type" name="group_by_registration_type" context="{'group_by': 'registration_type'}"/>
                    <filter string="Campus" name="group_by_campus" context="{'group_by': 'campus_id'}"/>
                    <filter string="Physician" name="group_by_physician" context="{'group_by': 'physician_id'}"/>
                    <filter string="Date" name="group_by_date" context="{'group_by': 'date:month'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- Registration Form Kanban View -->
    <record id="view_hospital_registration_form_kanban" model="ir.ui.view">
        <field name="name">hospital.registration.form.kanban</field>
        <field name="model">hospital.registration.form</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" default_group_by="state">
                <field name="reference"/>
                <field name="name"/>
                <field name="date"/>
                <field name="registration_type"/>
                <field name="state"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="row">
                                <div class="col-6">
                                    <strong><field name="reference"/></strong>
                                </div>
                                <div class="col-6 text-end">
                                    <span class="badge rounded-pill" t-attf-class="
                                        #{state == 'draft' ? 'text-bg-info' :
                                          state == 'registered' ? 'text-bg-success' :
                                          state == 'admitted' ? 'text-bg-primary' :
                                          'text-bg-danger'}">
                                        <field name="state"/>
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <span><field name="name"/></span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <field name="date"/>
                                </div>
                                <div class="col-6 text-end">
                                    <field name="registration_type"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- Registration Form Calendar View -->
    <record id="view_hospital_registration_form_calendar" model="ir.ui.view">
        <field name="name">hospital.registration.form.calendar</field>
        <field name="model">hospital.registration.form</field>
        <field name="arch" type="xml">
            <calendar string="Registrations" date_start="date" color="state" mode="month">
                <field name="reference"/>
                <field name="name"/>
                <field name="registration_type"/>
            </calendar>
        </field>
    </record>
    
    <!-- Registration Form Action -->
    <record id="action_hospital_registration_form" model="ir.actions.act_window">
        <field name="name">Registration Forms</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">hospital.registration.form</field>
        <field name="view_mode">tree,kanban,form,calendar</field>
        <field name="search_view_id" ref="view_hospital_registration_form_search"/>
        <field name="context">{'search_default_draft': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first registration form!
            </p>
            <p>
                Register new patients or schedule admissions with registration forms.
            </p>
        </field>
    </record>
    
    <!-- Create Menu Item -->
    <!-- <menuitem id="menu_registration_forms" name="Registration Forms" 
              parent="menu_patient_management_root" 
              action="action_hospital_registration_form" 
              sequence="20"/> -->
</odoo>